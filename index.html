<html>
<title>jefvm.v3</title>
<script src="fs.js"></script>
<style>
	inp{ color:blue ; }
	err{ color:red  ; }
	tst{ color:brown; }
	ok { color:green; }
	svg{ border:1px solid fuchsia; height:200px; width:300px; }
	pre,body,textarea,button{ font-size: 10px; font-weight: normal; }
	pre,textarea{ width:100%; }
	textarea{ height:80px; }
</style>
<script src="jefvm.v3.js"></script>
jefvm.v3.js loaded of <span id='lenSys'></span> lines<br>
jefvm.v3_ext.js loaded of <span id='lenExt'></span> lines<br>
jefvm.v3_tst.js loaded of <span id='lenTst'></span> lines<br>
<pre id='jefLog'></pre>
<button type="button" onclick="onClick()">run jeforth</button>
<button type="button" onclick="prevInp()">&lt;</button>
<button type="button" onclick="nextInp()">&gt;</button>
<button type="button" onclick="clearJefTst()">clear</button>
<button type="button" onclick="saveJefTst()">save</button>
<textarea id='jefTst'>code del function(){
	vm.svg.removeChild(vm.a);
} end-code
code add function(){
	vm.svg.appendChild(vm.a);
} end-code
</textarea>
<svg>
  <g id=myGraph>
    <circle cx=70 cy=70 r=5></circle>
    <text transform="rotate(30 5,40)" x=10 y=25>I love SVG</text>
    <rect stroke="red" fill="none" x=10 y=10 height=130 width=120></rect>
  </g>
  <g transform="translate(100,30),rotate(45 60 60)">
	<use xlink:href="#myGraph" />
  </g>
</svg>
<script>
var svg=vm.svg=document.getElementsByTagName('svg')[0]; // the svg area
var g=vm.g=svg.children, g0=g[0], g1=g[1]; // 1st g, 2nd g
var gc=vm.gc=g0.children, c=vm.c=gc[0], t=vm.t=gc[1], r=vm.r=gc[2]; // circle, text, rect
var ms=0,time=setInterval(function(){var t;
	ms=(ms+1)%360,t='translate(100,30),rotate('+ms+' 60 60)';
	g1.setAttribute('transform',t);
},10)
vm.inp='inp', vm.tst='tst', vm.err='err', vm.ok='ok';
vm.ids=["lenSys","lenExt","lenTst","jefLog","jefTst"];
vm.ids.forEach(function(id){vm[id]=document.getElementById(id);})
var t,n=0;
t=fs.readFileSync("jefvm.v3.js","utf8");
vm.lenSys.innerHTML=t.split('\n').length;
vm.cr=function(msg){ var t=vm.tob+(msg||'');// get t=msg to print and clear tob
	if (t!==" <ok> ok</ok>") vm.lastTob=t;
	vm.tob='';
	vm.jefLog.innerHTML+=t+'\n';	// print out
	vm.jefLog.scrollTop=vm.jefLog.scrollHeight;
}
t=fs.readFileSync("jefvm.v3_ext.js","utf8");
vm.lenExt.innerHTML=t.split('\n').length;
vm.v3_tst=fs.readFileSync("jefvm.v3_tst.js","utf8");
var lines=vm.v3_tst.split('\n');
vm.lenTst.innerHTML=lines.length;
function onClick(){
	vm.exec(vm.jefTst.value);
}
function prevInp(){
	if(vm.iCmd>0)
		vm.jefTst.value=vm.cmds[--vm.iCmd];
}
function nextInp(){
	if(vm.iCmd<vm.cmds.length-1)
		vm.jefTst.value=vm.cmds[++vm.iCmd];
}
function clearJefTst(){
	vm.jefTst.value='';
}
</script>
<script src="jefvm.v3_ext.js"></script>
<script src="jefvm.v3_tst.js"></script>
<script>
onClick();
vm.jefTst.value='2 for del 1000 ms add 1000 ms next';
vm.fence=vm.cmds.length;
function saveJefTst(){
	var i=vm.v3_tst.lastIndexOf("vm.showTst('total tests '+tests+' passed '+passed);");
	var r=vm.v3_tst.substr(i);
	vm.v3_tst=vm.v3_tst.substr(0,i)+vm.cmds.slice(vm.fence).map(function(t){
		return 'vm.exec('+JSON.stringify(t)+');'
	}).join('\n')+'\n'+r;
	fs.writeFileSync("jefvm.v3_tst.js",vm.v3_tst,"utf8");
}
</script>
</html>